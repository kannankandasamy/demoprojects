/*
 * Script 	:	POC for General topics on snowflake
 * Author	:	Kannan Kandasamy
 */

USE DATABASE SNOWFLAKE;
--USE WAREHOUSE compute_wh;
USE SCHEMA ACCOUNT_USAGE;
USE ROLE AccountAdmin; -- or security admin

--fully suspend
CREATE OR REPLACE RESOURCE MONITOR rm1 WITH credit_quota = 30 TRIGGERS ON
	100 PERCENT do SUSPEND;

ALTER WAREHOUSE TEST_WH SET resource_monitor = rm1;

--do notify and then suspend
CREATE OR REPLACE RESOURCE MONITOR RM2 WITH credit_quota = 100 TRIGGERS 
	ON 50 PERCENT do NOTIFY
	ON 70 PERCENT do NOTIFY
	ON 100 PERCENT do SUSPEND;

ALTER WAREHOUSE PROCESS_WH SET resource_monitor = RM2;

--do NOTIFY AND THEN SUSPEND THEN SUSPEND_IMMEDIATE
CREATE OR REPLACE RESOURCE MONITOR RM3 WITH credit_quota = 500 
	FREQUENCY = WEEKLY 
	START_TIMESTAMP = IMMEDIATELY TRIGGERS 
	ON 80 PERCENT do NOTIFY
	ON 90 PERCENT do SUSPEND 
	ON 100 PERCENT do SUSPEND_IMMEDIATE;

 ALTER WAREHOUSE compute_wh SET resource_monitor = RM3;
 
 --ACCOUNT LEVEL RM
CREATE OR REPLACE RESOURCE MONITOR RM4 WITH credit_quota = 200 TRIGGERS 
	ON 80 PERCENT do NOTIFY
	ON 100 PERCENT do SUSPEND;

 ALTER ACCOUNT SET resource_monitor = RM4;